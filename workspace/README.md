# Focused Workspace Deployment MCP Server

A streamlined MCP server that enables Roo Code to leverage Skaffold for deploying static applications using the ConfigMap pattern (avoiding Docker dependency). Focus on core deployment lifecycle: scaffold → deploy → monitor → cleanup.

## 🎯 Overview

This MCP server provides 5 essential tools for deploying static content to Kubernetes:

1. **scaffold_configmap_app** - Copy ConfigMap-static boilerplate to `.roobrowser/skaffold/`
2. **deploy_app** - Deploy using `skaffold dev/run` from `.roobrowser/skaffold/`
3. **get_deployment_status** - Check status of deployed app
4. **get_deployment_logs** - Stream logs from deployed app
5. **cleanup_deployment** - Clean up deployed resources

## 🏗️ Architecture

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Roo Code      │───▶│   MCP Server    │───▶│   Skaffold      │
│   Extension     │    │   (Node.js)     │    │   CLI           │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                       │
                                               ┌───────▼────────┐
                                               │  ConfigMap     │
                                               │  + NGINX       │
                                               │  + Ingress     │
                                               └────────────────┘
```

## 📁 Project Structure

```
workspace/
├── .vscode-server/
│   └── settings.json           # MCP server configuration
├── .mcp-servers/
│   └── workspace-deployment/   # MCP server implementation
│       ├── package.json
│       ├── tsconfig.json
│       ├── src/
│       │   └── index.ts        # Main MCP server
│       ├── templates/
│       │   └── configmap-static/  # Deployment templates
│       │       ├── skaffold.yaml
│       │       └── k8s/
│       │           ├── configmap.yaml
│       │           ├── deployment.yaml
│       │           ├── service.yaml
│       │           └── ingress.yaml
│       └── dist/               # Compiled output
├── projects/
│   └── my-static-app/          # Example static app
│       ├── index.html
│       ├── style.css
│       ├── script.js
│       └── .roobrowser/        # Generated by MCP server
│           └── skaffold/       # Skaffold deployment files
└── Dockerfile.vscode-server    # Enhanced VSCode container
```

## 🚀 Quick Start

### 1. Natural Language Commands

```
User: "Deploy my static website in /projects/portfolio as 'portfolio-app' at /portfolio"

Roo Code → MCP Server:
1. scaffold_configmap_app(project_path: "projects/portfolio", app_name: "portfolio-app", ingress_path: "/portfolio")
2. deploy_app(project_path: "projects/portfolio", mode: "dev")

Result: App running at http://localhost/portfolio/
```

### 2. Step-by-Step Workflow

1. **Scaffold the deployment:**
   ```
   scaffold_configmap_app(
     project_path: "projects/my-static-app",
     app_name: "my-app",
     ingress_path: "/my-app"
   )
   ```

2. **Deploy with live reload:**
   ```
   deploy_app(
     project_path: "projects/my-static-app",
     mode: "dev"
   )
   ```

3. **Check status:**
   ```
   get_deployment_status(app_name: "my-app")
   ```

4. **View logs:**
   ```
   get_deployment_logs(app_name: "my-app")
   ```

5. **Clean up:**
   ```
   cleanup_deployment(project_path: "projects/my-static-app")
   ```

## 🔧 ConfigMap-Static Pattern

### Key Benefits
- ✅ **Zero Docker builds** - No Dockerfile needed
- ✅ **Fast deployment** - Direct file injection into ConfigMap
- ✅ **Live reload** - Skaffold watches for file changes
- ✅ **Simple debugging** - Standard NGINX + Kubernetes logs
- ✅ **Resource efficient** - Minimal container overhead

### How It Works

1. **Content Collection**: MCP server scans project directory for static files (HTML, CSS, JS, images)
2. **ConfigMap Generation**: Files are injected into Kubernetes ConfigMap as data entries
3. **NGINX Serving**: Standard nginx:alpine container mounts ConfigMap at `/usr/share/nginx/html`
4. **Ingress Routing**: Traffic routed to app via NGINX Ingress Controller
5. **Live Updates**: Skaffold watches source files and rebuilds ConfigMap on changes

### Template Variables

- `{{APP_NAME}}` - Application identifier (e.g., "my-app")
- `{{INGRESS_PATH}}` - URL path (e.g., "/my-app")
- `{{STATIC_CONTENT}}` - Injected file content in YAML format

## 🛠️ Development

### Building the MCP Server

```bash
cd workspace/.mcp-servers/workspace-deployment
npm install
npm run build
```

### Testing with Sample App

```bash
# The sample app is already created at workspace/projects/my-static-app/
# Use the MCP tools to deploy it:

1. scaffold_configmap_app(
     project_path: "projects/my-static-app",
     app_name: "sample-app",
     ingress_path: "/sample"
   )

2. deploy_app(
     project_path: "projects/my-static-app",
     mode: "dev"
   )

# Visit http://localhost/sample/ to see your deployed app
```

## 📋 MCP Tools Reference

### scaffold_configmap_app
**Description**: Create .roobrowser/skaffold/ with ConfigMap deployment boilerplate

**Parameters**:
- `project_path` (string, required): Path to project with static content
- `app_name` (string, required): Application name (lowercase, alphanumeric with hyphens)
- `ingress_path` (string, required): URL path for ingress (e.g., /my-app)

**Output**: Creates deployment files and reports processed file count

### deploy_app
**Description**: Deploy app using skaffold from .roobrowser/skaffold/

**Parameters**:
- `project_path` (string, required): Path to project containing .roobrowser/skaffold/
- `mode` (string, optional): "dev" (live reload) or "run" (one-time), default: "dev"

**Output**: Skaffold deployment output and status

### get_deployment_status
**Description**: Check status of deployed applications

**Parameters**:
- `app_name` (string, optional): Specific app to check, shows all roobrowser apps if empty

**Output**: Kubernetes pods, services, and ingress status

### get_deployment_logs
**Description**: Get logs from deployed application

**Parameters**:
- `app_name` (string, required): Application name to get logs from
- `follow` (boolean, optional): Stream logs (true) or snapshot (false), default: false

**Output**: Application logs from NGINX container

### cleanup_deployment
**Description**: Clean up deployed resources using skaffold delete

**Parameters**:
- `project_path` (string, required): Path to project containing .roobrowser/skaffold/

**Output**: Cleanup status and removed resources

## 🎉 Success Criteria

- ✅ **Simplicity**: Deploy static app in 2 commands
- ✅ **Speed**: Sub-30 second deployment time
- ✅ **Reliability**: Zero Docker dependency issues
- ✅ **Discoverability**: Natural language tool descriptions
- ✅ **Integration**: Seamless with existing Roo Code workflow

## 🔗 Integration with MVP Roo SaaS

This MCP server is designed to work within the existing MVP Roo SaaS infrastructure:

- **Kubernetes Cluster**: Uses the same kind cluster setup
- **RBAC**: Leverages existing workspace permissions
- **Ingress**: Routes through the same NGINX Ingress Controller
- **Monitoring**: Integrates with existing kubectl tooling

The MCP server extends the workspace capabilities without replacing the core infrastructure.
